---
# yaml-language-server: $schema=../docs-resources/schemas/defs-schema.json

$schema: ../docs-resources/schemas/defs-schema.json#

# Used to create normative rules for supervisor.adoc file.
# Tags refer to anchors in any adoc file for any ISA manual.

chapter_name: Supervisor Mode

normative_rule_definitions:
  - names: [sstatus_sz, sstatus_mode, sstatus_acc]
    tags: ["norm:sstatus"]

  - names: [sstatus-spp_sz, sstatus-spp_acc, sstatus-spp_op]
    tags: ["norm:sstatus-spp"]

  - names: [sstatus-sie_sz, sstatus-sie_acc, sstatus-sie_op]
    tags: ["norm:sstatus-sie"]

  - names: [sstatus-spie_sz, sstatus-spie_acc, sstatus-spie_op]
    tags: ["norm:sstatus-spie"]

  - names: [sstatus-uxl_acc, sstatus-uxl_op]
    tags: ["norm:sstatus-uxl"]
  - name: sstatus-uxl_sz
    tags: ["norm:sstatus-uxl_sz"]
  - name: sstatus-uxl_behavior
    tags: ["norm:sstatus-uxl_behavior"]

  - name: hint_sxlen
    kind: parameter
    tags: ["norm:hint_sxlen_param"]

  - names: [sstatus-mxr_sz, sstatus-mxr_acc, sstatus-mxr_op]
    tags: ["norm:sstatus-mxr"]

  - names: [sstatus-sum_sz, sstatus-sum_acc, sstatus-sum_op]
    tags: ["norm:sstatus-sum"]

  - name: sstatus-sum_satp-mode
    tags: ["norm:sstatus-sum_satp-mode"]

  - names: [sstatus-ube_sz, sstatus-ube_acc, sstatus-ube_op]
    tags: ["norm:sstatus-ube"]
  - name: sstatus-ube_implicit
    tags: ["norm:sstatus-ube_implicit"]

  - names: [sstatus-spelp_sz, sstatus-spelp_acc, sstatus-spelp_op, sstatus-spelp_Zicfilp]
    tags: ["norm:sstatus-spelp"]

  - names: [sstatus-sdt_sz, sstatus-sdt_acc, sstatus-sdt_op, sstatus-sdt_Ssdbltrp]
    tags: ["norm:sstatus-sdt"]

  - name: sstatus-sdt_sstatus-sie_overwrite
    tags: ["norm:sstatus-sdt_sstatus-sie_overwrite"]
  - name: sstatus-sdt_trap
    tags: ["norm:sstatus-sdt_trap"]
  - name: sstatus-sdt_sret
    tags: ["norm:sstatus-sdt_sret"]

  - names: [stvec_sz, stvec_acc, stvec_mode]
    tags: ["norm:stvec"]
  - name: stvec_op
    tags: ["norm:stvec_op"]
  - name: stvec_sz_base
    tags: ["norm:stvec_sz_base"]

  - names: [sip_sz, sie_sz, sip_mode, sie_mode]
    tags: ["norm:sip_sie"]
  - name: sie_sip_supervisor_strap
    tags: ["norm:sie_sip_supervisor_strap"]
  - name: sie_sip_strap_time_constraint
    tags: ["norm:sie_sip_strap_time_constraint"]
  - name: s_interrupt_priority
    tags: ["norm:s_interrupt_priority"]
  - name: sip_acc
    tags: ["norm:sip_acc"]
  - name: sip_op
    tags: ["norm:sip_op"]
  - name: sie_acc
    tags: ["norm:sie_acc"]

  - name: sip_sie_bits_sz
    tags: ["norm:sip_sie_bits_sz"]

  - names: [sip-seip_acc, sip-seip_op, sie-seie_acc, sie-seie_op]
    tags: ["norm:sip-seip_sie-seie"]

  - names: [sip-stip_acc, sip-stip_op, sie-stie_acc, sie-stie_op]
    tags: ["norm:sip-stip_sie-stie"]

  - names: [sip-ssip_acc, sip-ssip_op, sie-ssie_acc, sie-ssie_op]
    tags: ["norm:sip-ssip_sie-ssie"]

  - names: [sip-lcofip_Sscofpmf_acc, sip-lcofip_Sscofpmf_op, sie-lcofip_Sscofpmf_acc, sie-lcofip_Sscofpmf_op]
    tags: ["norm:sip_sie_Sscofpmf"]

  - names: [sip_unimpl_acc, sie_unimpl_acc]
    tags: ["norm:sip_sie_unimpl"]

  - names: [sip_priority_bit_order, sie_priority_bit_order]
    tags: ["norm:sip_sie_priority_bit_order"]

  - name: supervisor_timer_scheduling
    tags: ["norm:supervisor_timer_scheduling"]

  - names: [scounteren_sz, scounteren_mode]
    tags: ["norm:scounteren"]
  - name: scounteren_acc
    tags: ["norm:scounteren_acc"]
  - name: scounteren_op
    tags: ["norm:scounteren_op"]

  - names: [sscratch_sz, sscratch_acc, sscratch_mode]
    tags: ["norm:sscratch"]

  - names: [sepc_sz, sepc_acc, sepc_op, sepc_mode]
    tags: ["norm:sepc"]
  - name: sepc_op_mask_ialign32
    tags: ["norm:sepc_op_mask_ialign32"]
  - name: sepc_acc_invalid_addr
    tags: ["norm:sepc_acc_invalid_addr"]
  - name: sepc_op_trap_write
    tags: ["norm:sepc_op_trap_write"]

  - names: [scause_sz, scause_acc, scause_op]
    tags: ["norm:scause"]

  - names: [scause-interrupt_sz, scause-interrupt_op]
    tags: ["norm:scause-interrupt"]
  - name: scause-exception_code_acc
    tags: ["norm:scause-exception_code_acc"]
  - name: scause-exception_code_sz
    tags: ["norm:scause-exception_code_sz"]


  - names: [stval_sz, stval_op, stval_mode]
    tags: ["norm:stval"]
  - name: stval_op_faulting_addr
    tags: ["norm:stval_op_faulting_addr"]
  - name: stval_op_breakpoint
    tags: ["norm:stval_op_breakpoint"]
  - name: stval_op_load_store_fault
    tags: ["norm:stval_op_load_store_fault"]
  - name: stval_faulting_address_variable_instr
    tags: ["norm:stval_faulting_address_variable_instr"]
  - name: stval_op_illegal_instr
    tags: ["norm:stval_op_illegal_instr"]
  - name: stval_op_illegal_instr_format
    tags: ["norm:stval_op_illegal_instr_format"]
  - name: stval_exception_info
    tags: ["norm:stval_exception_info"]
  - name: stval_op_other_traps
    tags: ["norm:stval_op_other_traps"]
  - name: stval_acc
    tags: ["norm:stval_acc"]

  - names: [senvcfg_sz, senvcfg_acc, senvcfg_mode]
    tags: ["norm:senvcfg"]

  - names: [senvcfg-fiom_sz, senvcfg-fiom_op]
    tags: ["norm:senvcfg-fiom"]
  - name: senvcfg-fiom_op_atomic
    tags: ["norm:senvcfg-fiom_op_atomic"]
  - name: senvcfg-fiom_acc
    tags: ["norm:senvcfg-fiom_acc"]

  - name: senvcfg-pmm_Ssnpm
    tags: ["norm:senvcfg-pmm_Ssnpm"]

  - names: [senvcfg-lpe_Zicfilp_acc, senvcfg-lpe_Zicfilp_op]
    tags: ["norm:senvcfg-lpe_Zicfilp"]

  - names: [senvcfg-sse_Zicfilp_sz, senvcfg-sse_Zicfilp_op]
    tags: ["norm:senvcfg-sse_Zicfilp"]

  - names: [satp_sz, satp_acc, satp_op, satp_mode]
    tags: ["norm:satp"]
  - names: [satp-mode_sz, satp-mode_acc, satp-mode_op]
    tags: ["norm:satp-mode"]
  - name: satp-mode_sxlen32
    tags: ["norm:satp-mode_sxlen32"]

  - name: satp-mode_sxlen64
    tags: ["norm:satp-mode_sxlen64"]
  - name: satp-mode_op_unsupported
    tags: ["norm:satp-mode_op_unsupported"]
  - name: satp-asidlen
    kind: parameter
    tags: ["norm:satp-asidlen"]
  - name: satp_op_active
    tags: ["norm:satp_op_active"]
  - name: satp_op_sfence-vma
    tags: ["norm:satp_op_sfence-vma"]

  - name: sfence-vma_op
    tags: ["norm:sfence-vma_op"]
  - name: sfence-vma_ordering
    tags: ["norm:sfence-vma_ordering"]
  - name: sfence-vma_invalidation
    tags: ["norm:sfence-vma_invalidation"]
  - name: sfence-vma_all_asid_va
    tags: ["norm:sfence-vma_all_asid_va"]
  - name: sfence-vma_asid_only
    tags: ["norm:sfence-vma_asid_only"]
  - name: sfence-vma_va_all_asid
    tags: ["norm:sfence-vma_va_all_asid"]
  - name: sfence-vma_va_asid
    tags: ["norm:sfence-vma_va_asid"]
  - name: sfence-vma_invalid_va
    tags: ["norm:sfence-vma_invalid_va"]
  - name: sfence-vma_rs2_bits
    tags: ["norm:sfence-vma_rs2_bits"]
  - name: sfence-vma_ordering_semantics
    tags: ["norm:sfence-vma_ordering_semantics"]
  - name: sfence-vma_implicit_access
    tags: ["norm:sfence-vma_implicit_access"]
  - name: sfence-vma-sum-mxr_effect
    tags: ["norm:sfence-vma-sum-mxr_effect"]
  - name: sfence-vma-mode_effect
    tags: ["norm:sfence-vma-mode_effect"]
  - name: sfence-vma-asid_effect
    tags: ["norm:sfence-vma-asid_effect"]

  - name: asid_hart_private
    tags: ["norm:asid_hart_private"]

  - name: satp-mode_roz_sfence_illegal
    kind: parameter
    tags: ["norm:satp-mode_roz_sfence_illegal_param"]
  - name: fetch_page_fault_no_x
    tags: ["norm:fetch_page_fault_no_x"]
  - name: load_page_fault_no_r
    tags: ["norm:load_page_fault_no_r"]
  - name: store_page_fault_no_w
    tags: ["norm:store_page_fault_no_w"]


  # SV39-specific rules
  - name: Sv39_sxlen
    tags: ["norm:Sv39_sxlen"]
  - name: Sv39_va_sz
    tags: ["norm:Sv39_va_sz"]
  - name: Sv39_va_signext
    tags: ["norm:Sv39_va_signext"]
  - name: Sv39_vpn_sz
    tags: ["norm:Sv39_vpn_sz"]
  - name: satp-ppn_sv39_sz
    tags: ["norm:satp-ppn_sv39_sz"]
  - name: Sv39_levels
    tags: ["norm:Sv39_levels"]
  - name: Sv39_page_offset_sz
    tags: ["norm:Sv39_page_offset_sz"]
  - name: Sv39_pte_count
    tags: ["norm:Sv39_pte_count"]
  - name: Sv39_pte_sz
    tags: ["norm:Sv39_pte_sz"]
  - name: Sv39_pt_sz
    tags: ["norm:Sv39_pt_sz"]
  - name: Sv39_pt_align
    tags: ["norm:Sv39_pt_align"]
  - name: Sv39_pte_svnapot_rsv
    tags: ["norm:Sv39_pte_svnapot_rsv"]
  - name: Sv39_pte_svpbmt_rsv
    tags: ["norm:Sv39_pte_svpbmt_rsv"]
  - name: Sv39_pte_future_rsv
    tags: ["norm:Sv39_pte_future_rsv"]
  - name: Sv39_leaf_any_level
    tags: ["norm:Sv39_leaf_any_level"]
  - name: Sv39_page_sizes
    tags: ["norm:Sv39_page_sizes"]
  - name: Sv39_superpage_align
    tags: ["norm:Sv39_superpage_align"]
  - name: Sv39_superpage_align_fault
    tags: ["norm:Sv39_superpage_align_fault"]
  - name: Sv39_LEVELS
    tags: ["norm:Sv39_LEVELS"]
  - name: Sv39_PTESIZE
    tags: ["norm:Sv39_PTESIZE"]


  # SV48 Specific rules
  - name: Sv48_sxlen
    tags: ["norm:Sv48_sxlen"]
  - name: Sv48_va_sz
    tags: ["norm:Sv48_va_sz"]
  - name: Sv48_requires_Sv39
    tags: ["norm:Sv48_requires_Sv39"]
  - name: Sv48_va_signext
    tags: ["norm:Sv48_va_signext"]
  - name: Sv48_vpn_sz
    tags: ["norm:Sv48_vpn_sz"]
  - name: satp-ppn_sv48_sz
    tags: ["norm:satp-ppn_sv48_sz"]
  - name: Sv48_levels
    tags: ["norm:Sv48_levels"]
  - name: Sv48_page_offset_sz
    tags: ["norm:Sv48_page_offset_sz"]
  - name: Sv48_leaf_any_level
    tags: ["norm:Sv48_leaf_any_level"]
  - name: Sv48_page_sizes
    tags: ["norm:Sv48_page_sizes"]
  - name: Sv48_superpage_align
    tags: ["norm:Sv48_superpage_align"]
  - name: Sv48_superpage_align_fault
    tags: ["norm:Sv48_superpage_align_fault"]
  - name: Sv48_LEVELS
    tags: ["norm:Sv48_LEVELS"]
  - name: Sv48_PTESIZE
    tags: ["norm:Sv48_PTESIZE"]

  # SV57 Specific rules
  - name: Sv57_sxlen
    tags: ["norm:Sv57_sxlen"]
  - name: Sv57_va_sz
    tags: ["norm:Sv57_va_sz"]
  - name: Sv57_requires_Sv48
    tags: ["norm:Sv57_requires_Sv48"]
  - name: Sv57_va_signext
    tags: ["norm:Sv57_va_signext"]
  - name: Sv57_vpn_sz
    tags: ["norm:Sv57_vpn_sz"]
  - name: satp-ppn_sv57_sz
    tags: ["norm:satp-ppn_sv57_sz"]
  - name: Sv57_levels
    tags: ["norm:Sv57_levels"]
  - name: Sv57_page_offset_sz
    tags: ["norm:Sv57_page_offset_sz"]
  - name: Sv57_leaf_any_level
    tags: ["norm:Sv57_leaf_any_level"]
  - name: Sv57_page_sizes
    tags: ["norm:Sv57_page_sizes"]
  - name: Sv57_superpage_align
    tags: ["norm:Sv57_superpage_align"]
  - name: Sv57_superpage_align_fault
    tags: ["norm:Sv57_superpage_align_fault"]
  - name: Sv57_LEVELS
    tags: ["norm:Sv57_LEVELS"]
  - name: Sv57_PTESIZE
    tags: ["norm:Sv57_PTESIZE"]

  # Svnapot Extension rules
  - name: Svnapot_depends_Sv39
    tags: ["norm:Svnapot_depends_Sv39"]
  - name: Svnapot_pte_N
    tags: ["norm:Svnapot_pte_N"]
  - name: Svnapot_range_napot
    tags: ["norm:Svnapot_range_napot"]
  - name: Svnapot_valid_encoding
    tags: ["norm:Svnapot_valid_encoding"]
  - name: Svnapot_reserved_encoding_fault
    tags: ["norm:Svnapot_reserved_encoding_fault"]
  - name: Svnapot_implicit_read_ppn_subst
    tags: ["norm:Svnapot_implicit_read_ppn_subst"]
  - name: Svnapot_cache_entries
    tags: ["norm:Svnapot_cache_entries"]
  - name: Svnapot_hyp_gstage
    tags: ["norm:Svnapot_hyp_gstage"]

  # Svpbmt Extension rules
  - name: Svpbmt_depends_Sv39
    tags: ["norm:Svpbmt_depends_Sv39"]

  - name: Svpbmt_impl_may_override_pmas
    tags: ["norm:Svpbmt_impl_may_override_pmas"]
  - name: Svpbmt_nonleaf_pte_pbmt_must_be_zero
    tags: ["norm:Svpbmt_nonleaf_pte_pbmt_must_be_zero"]
  - name: Svpbmt_leaf_pte_pbmt_reserved_3_fault
    tags: ["norm:Svpbmt_leaf_pte_pbmt_reserved_3_fault"]
  - name: Svpbmt_obeys_mem_ordering
    tags: ["norm:Svpbmt_obeys_mem_ordering"]
  - name: Svpbmt_io_pma_nc_pbmt_obey_rvwmo
    tags: ["norm:Svpbmt_io_pma_nc_pbmt_obey_rvwmo"]
  - name: Svpbmt_io_pma_nc_pbmt_treated_as_io_and_memory
    tags: ["norm:Svpbmt_io_pma_nc_pbmt_treated_as_io_and_memory"]
  - name: Svpbmt_memory_pma_io_pbmt_strong_io_ordering
    tags: ["norm:Svpbmt_memory_pma_io_pbmt_strong_io_ordering"]
  - name: Svpbmt_memory_pma_io_pbmt_treated_as_io_and_memory
    tags: ["norm:Svpbmt_memory_pma_io_pbmt_treated_as_io_and_memory"]
  - name: Svpbmt_aliasing_attribute
    tags: ["norm:Svpbmt_aliasing_attribute"]
  - name: Svpbmt_noncacheable_aliasing_no_coherence_loss
    tags: ["norm:Svpbmt_noncacheable_aliasing_no_coherence_loss"]
  - name: Svpbmt_noncacheable_aliasing_may_weaken_ordering
    tags: ["norm:Svpbmt_noncacheable_aliasing_may_weaken_ordering"]
  - name: Svpbmt_noncacheable_aliasing_fence_prevents_ordering_loss
    tags: ["norm:Svpbmt_noncacheable_aliasing_fence_prevents_ordering_loss"]
  - name: Svpbmt_cacheable_aliasing_may_cause_coherence_loss
    tags: ["norm:Svpbmt_cacheable_aliasing_may_cause_coherence_loss"]
  - name: Svpbmt_cacheable_aliasing_fence_flush_fence_required
    tags: ["norm:Svpbmt_cacheable_aliasing_fence_flush_fence_required"]
  - name: Svpbmt_hgatp_stage_override_rule
    tags: ["norm:Svpbmt_hgatp_stage_override_rule"]
  - name: Svpbmt_vsatp_stage_override_rule
    tags: ["norm:Svpbmt_vsatp_stage_override_rule"]


  # Svinval extension
  - name: Svinval_split_fine_grained
    tags: ["norm:Svinval_split_fine_grained"]
  - name: Svinval_sinval_vma_invalidates_same_as_sfence_vma
    tags: ["norm:Svinval_sinval_vma_invalidates_same_as_sfence_vma"]
  - name: Svinval_sfence_w_inval_orders_before_sinval_vma
    tags: ["norm:Svinval_sfence_w_inval_orders_before_sinval_vma"]
  - name: Svinval_sequence_rs1_rs2
    tags: ["norm:Svinval_sequence_rs1_rs2"]
  - name: Svinval_sequence_reads_writes_before
    tags: ["norm:Svinval_sequence_reads_writes_before"]
  - name: Svinval_sequence_reads_writes_after
    tags: ["norm:Svinval_sequence_reads_writes_after"]
  - name: Svinval_hinval_vvma_gvma
    tags: ["norm:Svinval_hinval_vvma_gvma"]
  - name: Svinval_hinval_gvma_uses_vmid
    tags: ["norm:Svinval_hinval_gvma_uses_vmid"]
  - name: Svinval_illegal_instruction_u_mode
    tags: ["norm:Svinval_illegal_instruction_u_mode"]
  - name: Svinval_illegal_instruction_tvm
    tags: ["norm:Svinval_illegal_instruction_tvm"]
  - name: Svinval_virtual_instruction_vu_vs
    tags: ["norm:Svinval_virtual_instruction_vu_vs"]
  - name: Svinval_virtual_instruction_vtvms
    tags: ["norm:Svinval_virtual_instruction_vtvms"]
  - name: Svinval_sfence_w_inval_inval_u_mode
    tags: ["norm:Svinval_sfence_w_inval_inval_u_mode"]
  - name: Svinval_sfence_w_inval_inval_vu_mode
    tags: ["norm:Svinval_sfence_w_inval_inval_vu_mode"]
  - name: Svinval_sfence_w_inval_inval_s_vs_mode
    tags: ["norm:Svinval_sfence_w_inval_inval_s_vs_mode"]

  # svadu extension rules
  - name: Svadu_hw_update_a_d_bits
    tags: ["norm:Svadu_hw_update_a_d_bits"]
  - name: Svadu_hypervisor_adue_writable
    tags: ["norm:Svadu_hypervisor_adue_writable"]
  - name: Svadu_disabled_hw_update_falls_back_to_svade
    tags: ["norm:Svadu_disabled_hw_update_falls_back_to_svade"]

  # svvptc extension rules
  - name: Svvptc_explicit_stores_update_valid_bit
    tags: ["norm:Svvptc_explicit_stores_update_valid_bit"]

  # svrsw60t59b extension rules
  - name: Svrsw60t59b_reserved_bits_60_59
    tags: ["norm:Svrsw60t59b_reserved_bits_60_59"]
  - name: Svrsw60t59b_h_g_stage_reserved_bits
    tags: ["norm:Svrsw60t59b_h_g_stage_reserved_bits"]
  - name: Svrsw60t59b_depends_on_sv39
    tags: ["norm:Svrsw60t59b_depends_on_sv39"]

  # ssqosid extension rules
  - name: Ssqosid_shared_resource_need_management
    tags: ["norm:Ssqosid_shared_resource_need_management"]
  - name: Ssqosid_hw_monitoring_required
    tags: ["norm:Ssqosid_hw_monitoring_required"]
  - name: Ssqosid_srmcfg_introduced
    tags: ["norm:Ssqosid_srmcfg_introduced"]
  - name: Ssqosid_metadata_used_by_controllers
    tags: ["norm:Ssqosid_metadata_used_by_controllers"]
  - name: Ssqosid_cbqri_spec
    tags: ["norm:Ssqosid_cbqri_spec"]
  - name: Ssqosid_srmcfg_register_size
    tags: ["norm:Ssqosid_srmcfg_register_size"]
  - name: Ssqosid_rcid_mcid_accompany_requests
    tags: ["norm:Ssqosid_rcid_mcid_accompany_requests"]
  - name: Ssqosid_srmcfg_csr_applies_to_all_modes
    tags: ["norm:Ssqosid_srmcfg_csr_applies_to_all_modes"]
  - name: Ssqosid_smstateen_srmcfg_requires_mstateen0
    tags: ["norm:Ssqosid_smstateen_srmcfg_requires_mstateen0"]
  - name: Ssqosid_srmcfg_access_illegal_instruction
    tags: ["norm:Ssqosid_srmcfg_access_illegal_instruction"]
  - name: Ssqosid_srmcfg_access_virtual_instruction
    tags: ["norm:Ssqosid_srmcfg_access_virtual_instruction"]

  # Sstc extension
  - name: stimecmp-stimecmph_sz_acc
    summary: stimecmp is a 63-bit CSR with 64-bit precision; RV32 accesses split into stimecmp and stimecmph
    tags: ["norm:stimecmp-stimecmph_sz_acc"]

  - names: [mip_stip_op, sip_stip_op]
    summary: Supervisor timer interrupt becomes pending in mip/sip STIP when time >= stimecmp
    tags: ["norm:mip_sip-stip_op"]

  # Zicboz extension
  - name: senvcfg-cbze
    tag: "norm:senvcfg-cbze"
  - name: senvcfg-cbcfe
    tag: "norm:senvcfg-cbcfe"
  - name: senvcfg-cbie
    tag: "norm:senvcfg-cbie"
  - name: cbo-inval_s-mode_op
    tags: ["norm:cbo-inval_s-mode_op0", "norm:cbo-inval_s-mode_op1", "norm:cbo-inval_s-mode_op2"]
