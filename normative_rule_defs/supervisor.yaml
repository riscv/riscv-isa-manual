---
# yaml-language-server: $schema=../docs-resources/schemas/defs-schema.json

$schema: ../docs-resources/schemas/defs-schema.json#

# Used to create normative rules for supervisor.adoc file.
# Tags refer to anchors in any adoc file for any ISA manual.

chapter_name: Supervisor Mode

normative_rule_definitions:
  - names: [sstatus_sz, sstatus_mode, sstatus_acc]
    tags: ["norm:sstatus"]

  - names: [sstatus-spp_sz, sstatus-spp_acc, sstatus-spp_op]
    tags: ["norm:sstatus-spp"]

  - names: [sstatus-sie_sz, sstatus-sie_acc, sstatus-sie_op]
    tags: ["norm:sstatus-sie"]

  - names: [sstatus-spie_sz, sstatus-spie_acc, sstatus-spie_op]
    tags: ["norm:sstatus-spie"]

  - names: [sstatus-uxl_acc, sstatus-uxl_op]
    tags: ["norm:sstatus-uxl"]
  - name: sstatus-uxl_sz
    tags: ["norm:sstatus-uxl_sz"]
  - name: sstatus-uxl_behavior
    tags: ["norm:sstatus-uxl_behavior"]

  - name: hint_sxlen_param
    tags: ["norm:hint_sxlen_param"]

  - names: [sstatus-mxr_sz, sstatus-mxr_acc, sstatus-mxr_op]
    tags: ["norm:sstatus-mxr"]

  - names: [sstatus-sum_sz, sstatus-sum_acc, sstatus-sum_op]
    tags: ["norm:sstatus-sum"]

  - name: sstatus-sum_satp-mode
    tags: ["norm:sstatus-sum_satp-mode"]

  - names: [sstatus-ube_sz, sstatus-ube_acc, sstatus-ube_op]
    tags: ["norm:sstatus-ube"]
  - name: sstatus-ube_implicit
    tags: ["norm:sstatus-ube_implicit"]

  - names: [sstatus-spelp_sz, sstatus-spelp_acc, sstatus-spelp_op, sstatus-spelp_Zicfilp]
    tags: ["norm:sstatus-spelp"]

  - names: [sstatus-sdt_sz, sstatus-sdt_acc, sstatus-sdt_op, sstatus-sdt_Ssdbltrp]
    tags: ["norm:sstatus-sdt"]

  - name: sstatus-sdt_sstatus-sie_overwrite
    tags: ["norm:sstatus-sdt_sstatus-sie_overwrite"]
  - name: sstatus-sdt_trap
    tags: ["norm:sstatus-sdt_trap"]
  - name: sstatus-sdt_sret
    tags: ["norm:sstatus-sdt_sret"]

  - names: [stvec_sz, stvec_acc, stvec_mode]
    tags: ["norm:stvec"]
  - name: stvec_op
    tags: ["norm:stvec_op"]
  - name: stvec_sz_base
    tags: ["norm:stvec_sz_base"]

  - names: [sip_sz, sie_sz, sip_mode, sie_mode]
    tags: ["norm:sip_sie"]
  - name: sie_sip_supervisor_strap
    tags: ["norm:sie_sip_supervisor_strap"]
  - name: sie_sip_strap_time_constraint
    tags: ["norm:sie_sip_strap_time_constraint"]
  - name: s_interrupt_priority
    tags: ["norm:s_interrupt_priority"]
  - name: sip_acc
    tags: ["norm:sip_acc"]
  - name: sip_op
    tags: ["norm:sip_op"]
  - name: sie_acc
    tags: ["norm:sie_acc"]

  - name: sip_sie_bits_sz
    tags: ["norm:sip_sie_bits_sz"]

  - names: [sip-seip_acc, sip-seip_op, sie-seie_acc, sie-seie_op]
    tags: ["norm:sip-seip_sie-seie"]

  - names: [sip-stip_acc, sip-stip_op, sie-stie_acc, sie-stie_op]
    tags: ["norm:sip-stip_sie-stie"]

  - names: [sip-ssip_acc, sip-ssip_op, sie-ssie_acc, sie-ssie_op]
    tags: ["norm:sip-ssip_sie-ssie"]

  - names: [sip-lcofip_Sscofpmf_acc, sip-lcofip_Sscofpmf_op, sie-lcofip_Sscofpmf_acc, sie-lcofip_Sscofpmf_op]
    tags: ["norm:sip_sie_Sscofpmf"]

  - names: [sip_unimpl_acc, sie_unimpl_acc]
    tags: ["norm:sip_sie_unimpl"]

  - names: [sip_priority_bit_order, sie_priority_bit_order]
    tags: ["norm:sip_sie_priority_bit_order"]

  - name: supervisor_timer_scheduling
    tags: ["norm:supervisor_timer_scheduling"]

  - names: [scounteren_sz, scounteren_mode]
    tags: ["norm:scounteren"]
  - name: scounteren_acc
    tags: ["norm:scounteren_acc"]
  - name: scounteren_op,
    tags: ["norm:scounteren_op"]

  - names: [sscratch_sz, sscratch_acc, sscratch_mode]
    tags: ["norm:sscratch"]

  - names: [sepc_sz, sepc_acc, sepc_op, sepc_mode]
    tags: ["norm:sepc"]
  - name: sepc_op_mask_ialign32
    tags: ["norm:sepc_op_mask_ialign32"]
  - name: sepc_acc_invalid_addr
    tags: ["norm:sepc_acc_invalid_addr"]
  - name: sepc_op_trap_write
    tags: ["norm:sepc_op_trap_write"]

  - names: [scause_sz, scause_acc, scause_op]
    tags: ["norm:scause"]

  - names: [scause-interrupt_sz, scause-interrupt_op]
    tags: ["norm:scause-interrupt"]
  - name: scause-exception_code_acc
    tags: ["norm:scause-exception_code_acc"]
  - name: scause-exception_code_sz
    tags: ["norm:scause-exception_code_sz"]


  - names: [stval_sz, stval_op, stval_mode]
    tags: ["norm:stval"]
  - name: stval_op_faulting_addr
    tags: ["norm:stval_op_faulting_addr"]
  - name: stval_op_breakpoint
    tags: ["norm:stval_op_breakpoint"]
  - name: stval_op_load_store_fault
    tags: ["norm:stval_op_load_store_fault"]
  - name: stval_faulting_address_variable_instr
    tags: ["norm:stval_faulting_address_variable_instr"]
  - name: stval_op_illegal_instr
    tags: ["norm:stval_op_illegal_instr"]
  - name: stval_op_illegal_instr_format
    tags: ["norm:stval_op_illegal_instr_format"]
  - name: stval_exception_info
    tags: ["norm:stval_exception_info"]
  - name: stval_op_other_traps
    tags: ["norm:stval_op_other_traps"]
  - name: stval_acc
    tags: ["norm:stval_acc"]

  - names: [senvcfg_sz, senvcfg_acc, senvcfg_mode]
    tags: ["norm:senvcfg"]

  - names: [senvcfg-fiom_sz, senvcfg-fiom_op]
    tags: ["norm:senvcfg-fiom"]
  - name: senvcfg-fiom_op_atomic
    tags: ["norm:senvcfg-fiom_op_atomic"]
  - name: senvcfg-fiom_acc
    tags: ["norm:senvcfg-fiom_acc"]

  - name: senvcfg-cbze_Zicboz
    tags: ["norm:senvcfg-cbze_Zicboz"]
  - names: [senvcfg-cbcfe_Zicbom, senvcfg-cbie_Zicbom]
    tags: ["norm:senvcfg-cbcfe-cbie_Zicbom"]

  - name: senvcfg-pmm_Ssnpm
    tags: ["norm:senvcfg-pmm_Ssnpm"]

  - names: [senvcfg-lpe_Zicfilp_acc, senvcfg-lpe_Zicfilp_op]
    tags: ["norm:senvcfg-lpe_Zicfilp"]

  - names: [senvcfg-sse_Zicfilp_sz, senvcfg-sse_Zicfilp_op]
    tags: ["norm:senvcfg-sse_Zicfilp"]

  - names: [satp_sz, satp_acc, satp_op, satp_mode]
    tags: ["norm:satp"]
  - names: [satp-mode_sz, satp-mode_acc, satp-mode_op]
    tags: ["norm:satp-mode"]
  - name: satp-mode_sxlen32
    tags: ["norm:satp-mode_sxlen32"]

  - name: satp-mode_sxlen64
    tags: ["norm:satp-mode_sxlen64"]
  - name: satp-mode_op_unsupported
    tags: ["norm:satp-mode_op_unsupported"]
  - name: satp-asidlen_param
    tags: ["norm:satp-asidlen"]
  - name: satp_op_active
    tags: ["norm:satp_op_active"]
  - name: satp_op_sfence-vma
    tags: ["norm:satp_op_sfence-vma"]

  - name: sfence-vma_op
    tags: ["norm:sfence-vma_op"]
  - name: sfence-vma_ordering
    tags: ["norm:sfence-vma_ordering"]
  - name: sfence-vma_invalidation
    tags: ["norm:sfence-vma_invalidation"]
  - name: sfence-vma_all_asid_va
    tags: ["norm:sfence-vma_all_asid_va"]
  - name: sfence-vma_asid_only
    tags: ["norm:sfence-vma_asid_only"]
  - name: sfence-vma_va_all_asid
    tags: ["norm:sfence-vma_va_all_asid"]
  - name: sfence-vma_va_asid
    tags: ["norm:sfence-vma_va_asid"]
  - name: sfence-vma_invalid_va
    tags: ["norm:sfence-vma_invalid_va"]
  - name: sfence-vma_rs2_bits
    tags: ["norm:sfence-vma_rs2_bits"]
  - name: sfence-vma_ordering_semantics
    tags: ["norm:sfence-vma_ordering_semantics"]
  - name: sfence-vma_implicit_access
    tags: ["norm:sfence-vma_implicit_access"]
  - name: sfence-vma-sum-mxr_effect
    tags: ["norm:sfence-vma-sum-mxr_effect"]
  - name: sfence-vma-mode_effect
    tags: ["norm:sfence-vma-mode_effect"]
  - name: sfence-vma-asid_effect
    tags: ["norm:sfence-vma-asid_effect"]

  - name: asid_hart_private
    tags: ["norm:asid_hart_private"]

  - name: satp-mode_roz_sfence_illegal_param
    tags: ["norm:satp-mode_roz_sfence_illegal_param"]
  - name: fetch_page_fault_no_x
    tags: ["norm:fetch_page_fault_no_x"]
  - name: load_page_fault_no_r
    tags: ["norm:load_page_fault_no_r"]
  - name: store_page_fault_no_w
    tags: ["norm:store_page_fault_no_w"]

  - name: satp_mode_field
    summary: Defines the mode of the virtual memory
    tags: ["norm:satp_mode_field"]

  - name: pte_valid_bit_behavior
    summary: Defines the function of the PTE valid bit (V).
    tags: ["norm:pte_valid_bit_behavior"]

  - name: pte_permission_bits
    summary: Defines R, W, and X permission bits in PTE.
    tags: ["norm:pte_permission_bits"]

  - name: pte_leaf_vs_pointer
    summary: Determines when a PTE is a pointer or a leaf.
    tags: ["norm:pte_leaf_vs_pointer"]

  - name: pte_writable_requires_readable
    summary: Writable pages must also be marked readable.
    tags: ["norm:pte_writable_requires_readable"]

  - name: page_fault_fetch_no_exec
    summary: Page fault occurs when fetching an instruction from a page with no execute permissions.
    tags: ["norm:page_fault_fetch_no_exec"]

  - name: page_fault_load_no_read
    summary: Page fault occurs when executing a load from a page with no read permissions.
    tags: ["norm:page_fault_load_no_read"]

  - name: page_fault_store_no_write
    summary: Page fault occurs when executing a store from a page with no write permissions.
    tags: ["norm:page_fault_store_no_write"]

  - name: page_fault_store_amo
    summary: Attempting AMO on unreadable page causes store page fault.
    tags: ["norm:page_fault_store_amo"]

  - name: sstatus-u-bit
    summary: If sstatus.U is set, page is accessible to U mode.
    tags: ["norm:sstatus-u-bit"]

  - name: sstatus-sum-bit
    summary: Is sstatus.SUM is set, supervisor mode can access pages in U-mode.
    tags: ["norm:sstatus-sum-bit"]

  - name: sstatus-sum-clear
    summary: If sstatus.SUM is clear, access to U-mode pages will fault.
    tags: ["norm:sstatus-sum-clear"]

  - name: s_mode_exec_restriction_u_bit
    summary: Supervisor may not execute pages with sstatus.U bit set.
    tags: ["norm:s_mode_exec_restriction_u_bit"]

  - name: global_mapping_cache_behavior
    summary: Global mappings may be shared across ASIDs and are exempt from certain SFENCE.VMA flushes.
    tags: ["norm:global_mapping_cache_behavior"]

  - name: rsw_bit_behavior
    summary: Hardware must ignore this bit feild, it is reserved for future.
    tags: ["norm:rsw_bit_behavior"]

  - name: pte_a_bit
    summary: A bit indicates if virtual page has been accessed.
    tags: ["norm:pte_a_bit"]

  - name: pte_d_bit
    summary: D bit indicates if virtual page has been written.
    tags: ["norm:pte_d_bit"]

  - name: svade_extension_page_fault
    summary: If A bit clear/written and D bit is clear, page fault is raised upon vitual page access.
    tags: ["norm:svade_extension_page_fault"]

  - name: pte_a_bit_update
    summary: If A bit is clear and virtual page is accessed, PTE.A bit is updated to set.
    tags: ["norm:pte_a_bit_update"]

  - name: pte_d_bit_update
    summary: If D bit is clear and virtual page is accessed, PTE.D bit is updated to set.
    tags: ["norm:pte_d_bit_update"]

  - name: gstage_implicit_access_behavior
    summary: Accesses to VS-level memory structures are subject to G-stage translation when enabled.
    tags: ["norm:gstage_implicit_access_behavior"]

  - name: vs_stage_g_stage_pte_update
    summary: Both VS-stage and G-stage PTEs are updated in two stage translation.
    tags: ["norm:vs_stage_g_stage_pte_update"]

  - name: pte_update_atomicity
    summary: PTE updates and related page-table walk checks must be performed atomically.
    tags: ["norm:pte_update_atomicity"]

  - name: pte_a_bit_speculative_update
    summary: The A bit may be set speculatively.
    tags: ["norm:pte_a_bit_speculative_update"]

  - name: pte_d_bit_exact_update
    summary:  The D bit must be updated exactly.
    tags: ["norm:pte_d_bit_exact_update"]

  - name: gstage_d_bit_update_from_vs_access
    summary: G-stage D-bit may be updated implicitly due to VS-stage PTE access.
    tags: ["norm:gstage_d_bit_update_from_vs_access"]

  - name: pte_update_ordering
    summary: PTE updates must appear in global memory order before the triggering access.
    tags: ["norm:pte_update_ordering"]

  - name: pte_update_atomicity_memory
    summary: PTE update is not required to be atomic wth repsect to memory.
    tags: ["norm:pte_update_atomicity_memory"]

  - name: pte_a_d_bit_trap_update
    summary: A and D bit of PTE are updated in case of a trap, irrespective of memory access.
    tags: ["norm:pte_a_d_bit_trap_update"]

  - name: hart_memory_access_pte_update
    tags: ["norm:hart_memory_access_pte_update"]

  - name: hardware_access_page_table
    summary: Hardware must have write access on page tables.
    tags: ["norm:hardware_access_page_table"]

  - name: pte_same_hart_update
    summary: Same PTE update sceme for all harts.
    tags: ["norm:pte_same_hart_update"]

  - name: pte_update_not_fence_ordered
    summary: PTE updates after a memory access are not ordered by fence.
    tags: ["norm:pte_update_not_fence_ordered"] 

  - name: pte_d_bit_update_order
    summary: PTE D bit updates must be exact and in program order.
    tags: ["norm:pte_d_bit_update_order"]

  - name: pte_ad_bits_not_clear
    summary: A and D bits are not cleared by implementation.
    tags: ["norm:pte_ad_bits_not_clear"]

  - name: megapage_alignment
    summary: Megapage must be aligned to 4MiB boundary.
    tags: ["norm:megapage_alignment"]

  - name: page_fault_misaligned_pa
    summary: Page fault exception for misaligned PA.
    tags: ["norm:page_fault_misaligned_pa"]

  - name: lrsc_reservation_within_page
    summary: LR/SC reservation set must lie completely within a single base physical page.
    tags: ["norm:lrsc_reservation_within_page"]

  - name: misaligned_load_store_succeed
    summary: Mislaigned load store are decomposed into musltiple accesses, some of which might succeed.
    tags: ["norm:misaligned_load_store_succeed"]

  - name: pte_violate_pma_pmp_check
    summary: Access fault exception on violation of pma/pmp check.
    tags: ["norm:pte_violate_pma_pmp_check"]

  - name: pte_reserved_encoding_pagefault
    summary: If any of the reserved bit encodings are set, page fault exception will occur.
    tags: ["norm:pte_reserved_encoding_pagefault"]

  - name: smallest_pagetable_level
    summary: For sv32, smallest value of i(LEVELS-1) is 0.
    tags: ["norm:smallest_pagetable_level"]

  - name: misaligned_superpage_pagefault
    summary: If i is greater than 0 at a leaf pte, raise a pagefault exception.
    tags: ["norm:misaligned_superpage_pagefault"]

  - name: memory_access_by_pte_u_bit
    summary: If memory access is not allowed by pte u bit, a page fault is raised.
    tags: ["norm:memory_access_by_pte_u_bit"]

  - name: pte_rwx_shadowstack_check
    summary: Memory access permissions must respect PTE R/W/X bits under Shadow Stack Protection rules.
    tags: ["norm:pte_rwx_shadowstack_check"]

  - name: pte_rwx_access_check
    summary: Memory access permissions must respect PTE R/W/X bits.
    tags: ["norm:pte_rwx_access_check"]

  - name: pte_ad_svade_fault
    summary: For pte.a and pte.d bits cleared, we get a page fault exception if svade is implemented.
    tags: ["norm:pte_ad_svade_fault"]

  - name: pte_store_pma_pmp_check
    summary: If a store to a pte violates pmp/pma check, raise access-fault.
    tags: ["norm:pte_store_pma_pmp_check"]

  - name: address_translation_cache_behavior
    summary: Describes how implicit address-translation reads may be cached locally and the requirement of SFENCE.VMA to maintain coherence.
    tags: ["norm:address_translation_cache_behavior"]

  - name: pte_ad_memory_update
    summary: A/D bits are directly updated in the memory.
    tags: ["norm:pte_ad_memory_update"]

  - name: speculative_translation_execution
    summary: Restricts speculative address translation from setting D-bit, triggering exceptions, or caching invalid entries.
    tags: ["norm:speculative_translation_execution"]

  - name: addr_sign_extension_violation
    summary: Instruction fetch and memory access addresses must have bits 63â€“39 equal to bit 38 or cause a page-fault exception.
    tags: ["norm:addr_sign_extension_violation"]

  - name: page_table_alignment
    summary: Page table must be aligned to a page boundary.
    tags: ["norm:page_table_alignment"]

  - name: svnapot_bit63_reserved
    summary: Bit 63 must be zeroed by software if Svnapot is not implemented.
    tags: ["norm:svnapot_bit63_reserved"]

  - name: svnapot_bit_62_61_reserved
    summary: Bit 63 must be zeroed by software if Svnpbmt is not implemented.
    tags: ["norm:svnapot_bit_62_61_reserved"]

  - name: pte_reserved_bits_60_54
    summary: Bit 54 to 60 are reserved for future use.
    tags: ["norm:pte_reserved_bits_60_54"]

  - name: sv39_page_alignment
    summary: Pages must be virtually and physically aligned to boundary equal to its size.
    tags: ["norm:sv39_page_alignment"]

  - name: sv48_support
    summary: sv48 cannot be implemented without implementing sv39.
    tags: ["norm:sv48_support"]

  - name: sv48_sign_extension_violation
    summary: Bits 48 to 63 must be equal to bit 47.
    tags: ["norm:sv48_sign_extension_violation"]

  - name: sv57_support
    summary: sv 57 cannot be implemented without implementing sv48.
    tags: ["norm:sv57_support"]

  - name: sv57_sign_extension_violation
    summary: Bits 57 to 63 must be equal to bit 56.
    tags: ["norm:sv57_sign_extension_violation"]