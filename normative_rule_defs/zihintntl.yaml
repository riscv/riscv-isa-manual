---
# yaml-language-server: $schema=../docs-resources/schemas/defs-schema.json

$schema: "../docs-resources/schemas/defs-schema.json#"

# Used to create normative rules for zihintntl.adoc file.
# Tags refer to anchors in any adoc file for any ISA manual.

chapter_name: Zihintntl (Non-tmp Hint)


normative_rule_definitions:
  # Target definition
  - name: NTL-target_definition
    clarification-text: >
      The target instruction of an NTL instruction SHALL be the instruction
      immediately following it in program order, and only the immediately
      preceding NTL instruction applies to any given memory-access instruction
    clarification-link: https://github.com/riscv/riscv-isa-manual/issues/2519
    tags: ["norm:NTL-target_definition"]

  # NTL.P1
  - name: NTL-P1_op
    summary: NTL.P1 indicates the target instruction does not exhibit temporal locality within the innermost level of private cache
    tags: ["norm:NTL-P1_op"]

  - name: NTL-P1_enc
    summary: NTL.P1 is encoded as ADD x0, x0, x2
    tags: ["norm:NTL-P1_enc"]

  # NTL.PALL
  - name: NTL-PALL_op
    summary: NTL.PALL indicates the target instruction does not exhibit temporal locality within any level of private cache
    tags: ["norm:NTL-PALL_op"]

  - name: NTL-PALL_enc
    summary: NTL.PALL is encoded as ADD x0, x0, x3
    tags: ["norm:NTL-PALL_enc"]

  # NTL.S1
  - name: NTL-S1_op
    summary: NTL.S1 indicates the target instruction does not exhibit temporal locality within the innermost level of shared cache
    tags: ["norm:NTL-S1_op"]

  - name: NTL-S1_enc
    summary: NTL.S1 is encoded as ADD x0, x0, x4
    tags: ["norm:NTL-S1_enc"]

  # NTL.ALL
  - name: NTL-ALL_op
    summary: NTL.ALL indicates the target instruction does not exhibit temporal locality within any level of cache
    tags: ["norm:NTL-ALL_op"]

  - name: NTL-ALL_enc
    summary: NTL.ALL is encoded as ADD x0, x0, x5
    tags: ["norm:NTL-ALL_enc"]

  # Compressed availability condition
  - name: C-NTL-availability
    summary: If the C or Zca extension is provided, compressed variants of these HINTs are also provided
    tags: ["norm:NTL-compressed_variants"]

  # Compressed variants â€” all share the same tag
  - name: C-NTL-P1_op
    summary: C.NTL.P1 indicates the target instruction does not exhibit temporal locality within the innermost private cache (compressed variant)
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-P1_enc
    summary: C.NTL.P1 is encoded as C.ADD x0, x2
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-PALL_op
    summary: C.NTL.PALL indicates the target instruction does not exhibit temporal locality within any private cache (compressed variant)
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-PALL_enc
    summary: C.NTL.PALL is encoded as C.ADD x0, x3
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-S1_op
    summary: C.NTL.S1 indicates the target instruction does not exhibit temporal locality within the innermost shared cache (compressed variant)
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-S1_enc
    summary: C.NTL.S1 is encoded as C.ADD x0, x4
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-ALL_op
    summary: C.NTL.ALL indicates the target instruction does not exhibit temporal locality within any cache (compressed variant)
    tags: ["norm:NTL-compressed_variants"]

  - name: C-NTL-ALL_enc
    summary: C.NTL.ALL is encoded as C.ADD x0, x5
    tags: ["norm:NTL-compressed_variants"]

  # Range restriction
  - name: NTL_range
    summary: NTL instructions affect all memory-access instructions except Zicbom cache-management instructions
    tags: ["norm:NTL_range"]

  # Prefetch interaction
  - name: NTL_Zicob_prefetch_outer
    summary: When an NTL is applied to a Zicbop prefetch hint, the cache line is prefetched into a cache outer from the level specified by the NTL
    tags: ["norm:NTL_Zicob_prefetch_outer"]

  # Trap behavior
  - name: NTL-trap_behavior
    kind: parameter
    summary: >
      In the event that a trap is taken on the target instruction, implementations are discouraged from applying the NTL to the first instruction in the
      trap handler.
      Instead, implementations are recommended to ignore the HINT in this case.
    tags: ["norm:NTL-trap_behavior"]

  # LR/SC exception
  - name: NTL-LR_SC_exception
    summary: Since the NTL instructions are encoded as ADDs, they can be used within LR/SC loops without voiding the forward-progress guarantee
    tags: ["norm:NTL-LR_SC_exception"]
